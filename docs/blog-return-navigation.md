# ブログ詳細「戻る」導線 要件定義書

## 背景
- ViewTransition を使った遷移で「すぐ元の状態に戻れる」体験を重視する。
- ブログ詳細ページ上部の「ブログ一覧に戻る」導線を、来訪元に応じて最適に動作させたい。

## 対象
- 詳細ページ: `/blog/[slug]`
- 一覧系ページ（以後「一覧系」）:
  - `/blog`
  - `/blog/page/[page]`（例: `/blog/8`）

## ゴール
- 一覧系から詳細へ遷移した場合、同じ一覧パスへ戻れる（位置復元はしない）。
- 直接アクセスなど一覧系以外から来た場合は、最低限 `/blog` へ戻れる。
- ViewTransition と整合する自然な戻り体験を提供する。

## 動作要件
1) 一覧ページでの保存
   - 対象: `/blog`, `/blog/page/[page]`
   - クライアントのみで `sessionStorage` に現在の一覧パスを保存。キー: `BLOG_NAVIGATION_CONSTANTS.LIST_PATH_STORAGE_KEY`
2) 戻り先の決定ロジック
   - 保存された一覧パスがあればそれを最優先で `router.push`。
   - 保存が無い場合は `router.back()`。
   - 履歴が無い場合のみ `/blog` へフォールバック。

4) 非機能・考慮点
   - サーバーコードに副作用を入れない。保存は必ずクライアントのみ。
   - ViewTransition 名や既存スタイルは壊さない（戻りボタンの見た目は現状維持）。
   - 戻り先判定のパスルールは拡張しやすくする（例: カテゴリ一覧を追加しても対応容易）。
   - 戻りボタンは連打されても壊れないよう同期処理のみで実装（追加のローディング UI は不要）。

5) テスト観点（手動想定）
   - `/blog` → 任意記事 → 戻る: `/blog` へ戻る。
   - `/blog/8` → 任意記事 → 戻る: `/blog/8` へ戻る。
   - 外部/直接アクセスで詳細表示 → 戻る: `/blog` へ遷移。
   - リロード後に戻るボタン押下: 保存が無いので `/blog` へ遷移。

## 追加で決めておきたいこと（未定義なら実装時に相談）
- 一覧系の範囲（タグ以外にカテゴリ等を含めるか）。
- `document.referrer` の判定許容ドメイン（自サイトのみを対象にするか）。
- 戻る遷移にアニメーションを付与するか（現状は不要想定）。
