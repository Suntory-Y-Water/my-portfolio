# ブログ記事管理システム移行 要件定義書

**文書番号**: REQ-2025-001
**作成日**: 2025-11-14
**バージョン**: 1.0
**ステータス**: Draft（意思決定待ち）

---

## 1. プロジェクト概要

### 1.1 目的
Obsidianでのブログ記事執筆を可能にするため、現在の`src/content/blog/`配下のMDXファイル管理から、`content/blog/`配下のMarkdownファイル管理へ移行する。

### 1.2 背景
- **現状の課題**: Obsidianは標準MarkdownをサポートするがMDXは未サポート
- **ユーザーニーズ**: PCがなくてもObsidianモバイルアプリで記事を執筆したい
- **参考実装**: azukiazusa.dev（sapper-blog-app）のブログ構成を参考にする

### 1.3 スコープ

#### 対象範囲
- ブログ記事ファイルの配置場所変更
- ファイル形式のMDX→MD変換
- ビルドシステムのMDX処理→Markdown処理への移行
- Obsidianでのプレビュー・編集対応

#### 対象外
- ブログUI/UXの変更
- 既存記事コンテンツの大幅な書き直し
- タグ管理システムの変更（既存のslug管理を維持）

---

## 2. 機能要件

### FR-01: ファイル配置変更

**要件ID**: FR-01
**優先度**: 必須

#### 詳細
- ブログ記事ファイルを`src/content/blog/`から`content/blog/`へ移動する
- `content/`ディレクトリをルート直下に配置することで、Obsidianのボルトとして設定可能にする

#### 受入条件
- [ ] 全記事ファイルが`content/blog/`配下に配置されている
- [ ] ビルド時に`content/blog/`から記事を読み込める
- [ ] 既存の記事URLパス（`/blog/{slug}`）が維持されている

---

### FR-02: ファイル形式変換（MDX → Markdown）

**要件ID**: FR-02
**優先度**: 必須

#### 詳細
- 全記事を`.mdx`から`.md`に変換する
- MDXコンポーネント（`<LinkPreview>`, `<Callout>`, `<Image>`）を標準Markdown構文に変換する

#### 変換仕様

| MDXコンポーネント | Markdown構文 | 使用箇所数 |
|------------------|-------------|-----------|
| `<LinkPreview url='...' />` | `[リンクテキスト](URL)` + remarkプラグイン | 46箇所 |
| `<Callout>...</Callout>` | GFM Alerts (`> [!NOTE]`) | 8箇所 |
| `<Image src='...' />` | 標準Markdown画像 (`![alt](url)`) | 11箇所 |

#### 受入条件
- [ ] 全記事が`.md`拡張子になっている
- [ ] MDXコンポーネント構文が残っていない
- [ ] 変換後の記事がObsidianで正しくプレビューされる
- [ ] 変換後の記事がブログサイトで正しく表示される

---

### FR-03: LinkPreview機能の実装

**要件ID**: FR-03
**優先度**: 必須

#### 詳細
現在の`<LinkPreview>`コンポーネントと同等の機能をMarkdownで実現する。

#### 実装方式（意思決定待ち）

**選択肢A**: remarkプラグイン活用
- `remark-link-card`または類似プラグインを導入
- Markdown標準リンク構文からカードUIを自動生成

**選択肢B**: カスタムremarkプラグイン開発
- 既存の`<LinkPreview>`ロジックをremarkプラグインに移植
- 独自の記法をサポート（例: `:::link-preview URL`）

**選択肢C**: 機能廃止
- プレーンなリンク表示のみ（非推奨）

#### 受入条件
- [ ] 外部リンクがカード形式で表示される
- [ ] OGP情報（タイトル、説明、画像）が取得・表示される
- [ ] 表示速度が現状と同等以上

---

### FR-04: Callout機能の実装

**要件ID**: FR-04
**優先度**: 必須

#### 詳細
GFM Alerts記法（`> [!NOTE]`）をサポートし、現在の`<Callout>`と同等のUIで表示する。

#### 実装方式
- `remark-alerts`または`rehype-alert`プラグインを導入
- 既存のCalloutスタイル（CSS）を維持

#### 対応する記法
```markdown
> [!NOTE]
> これは注意書きです

> [!WARNING]
> これは警告です

> [!TIP]
> これはヒントです
```

#### 受入条件
- [ ] GFM Alerts記法がパースされる
- [ ] 既存のCalloutと同等のUIで表示される
- [ ] type（NOTE/WARNING/TIP等）に応じたスタイルが適用される

---

### FR-05: Obsidian対応

**要件ID**: FR-05
**優先度**: 必須

#### 詳細
- `content/`ディレクトリをObsidianボルトとして設定可能にする
- Obsidianでのプレビュー・編集が正常に動作する

#### 受入条件
- [ ] Obsidianで`content/`をボルトとして開ける
- [ ] Markdown記法がObsidianでプレビューされる
- [ ] GFM Alerts（Callout）がObsidianで適切に表示される
- [ ] リンクがObsidianで機能する

---

## 3. 非機能要件

### NFR-01: パフォーマンス

**要件ID**: NFR-01
**優先度**: 必須

- ビルド時間が現状比150%以内（現在のMDXビルド時間を基準）
- ページ表示速度が現状と同等以上
- LinkPreview OGP取得はビルド時に実行（ランタイムでの遅延なし）

---

### NFR-02: 保守性

**要件ID**: NFR-02
**優先度**: 必須

- remarkプラグインの設定は`src/lib/markdown.ts`または設定ファイルに集約
- 新しいタグ追加時のチェックスクリプト（`check:tags`）は維持
- Obsidian設定ファイル（`.obsidian/`）はgitignoreに含める

---

### NFR-03: 互換性

**要件ID**: NFR-03
**優先度**: 必須

- 既存の記事URLパス（`/blog/{slug}`）を維持
- 既存のフロントマター形式を維持（または明示的に変更を決定）
- 既存のタグslug管理システム（`src/config/tag-slugs.ts`）を維持

---

### NFR-04: 拡張性

**要件ID**: NFR-04
**優先度**: 推奨

- 将来的なContentful CMS連携を想定した設計（参考: azukiazusa.dev）
- remarkプラグインの追加が容易な構成
- フロントマター形式の拡張が可能

---

## 4. 制約事項

### 技術的制約
- Next.js 15系を使用（現行バージョン維持）
- Bunランタイムを使用（パッケージマネージャはpnpm）
- TypeScript型安全性を維持

### 運用制約
- 移行中もブログは稼働させる（段階的移行を検討）
- 既存記事のURLは変更しない（SEO影響回避）

### リソース制約
- 移行作業の想定工数: 約11時間
- プロトタイプ検証期間: 2時間
- 本番移行期間: 1日以内

---

## 5. 意思決定が必要な項目

### 🔴 クリティカル（実装前に決定必須）

#### 決定事項1: LinkPreview実装方式
- **選択肢**: remarkプラグイン活用 / カスタム開発 / 機能廃止
- **判断基準**: 工数、保守性、機能要件の充足度
- **推奨**: remarkプラグイン活用（`remark-link-card`調査）
- **決定期限**: プロトタイプ検証開始前

#### 決定事項2: フロントマター形式
- **選択肢**: 現状維持 / azukiazusa.dev形式
- **現状維持の場合**:
  ```yaml
  title: ...
  date: 2025-03-17
  description: ...
  tags: [...]
  ```
- **azukiazusa.dev形式の場合**:
  ```yaml
  id: ...
  title: ...
  slug: ...
  createdAt: 2025-03-17T00:00:00.000+09:00
  updatedAt: 2025-03-17T00:00:00.000+09:00
  tags: [...]
  published: true
  ```
- **推奨**: 現状維持（移行コスト削減）
- **決定期限**: 変換スクリプト開発前

#### 決定事項3: 移行方式
- **選択肢**: 一括移行 / 段階的移行
- **一括移行**: 全記事を一度に変換・移行
- **段階的移行**: 新記事からMDで書き、既存記事は徐々に移行
- **推奨**: 一括移行（整合性維持のため）
- **決定期限**: 移行計画確定前

---

### 🟡 重要（実装中に決定可能）

#### 決定事項4: 画像管理方式
- **現状**: Cloudflare R2 + CDN
- **選択肢**: 現状維持 / content/配下に画像も配置
- **推奨**: 現状維持（Obsidianからもリモート画像参照可能）

#### 決定事項5: Obsidianプラグイン活用
- Obsidian Community Pluginを活用するか
- 例: `obsidian-link-preview`, `obsidian-admonition`
- **推奨**: 標準Markdown優先、プラグインは補助的に使用

---

## 6. 関連ドキュメント

- [移行計画書](./blog-migration-plan.md)
- [リスク管理表](./blog-migration-risks.md)
- [受入基準書](./blog-migration-acceptance-criteria.md)
- [ギャップ分析レポート](./blog-migration-gap-analysis.md)（作成推奨）

---

## 7. 承認履歴

| 日付 | 承認者 | ステータス | 備考 |
|------|--------|-----------|------|
| 2025-11-14 | - | Draft | 初版作成 |
| - | - | - | - |

---

## 8. 変更履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|---------|--------|
| 1.0 | 2025-11-14 | 初版作成 | Claude Code |
