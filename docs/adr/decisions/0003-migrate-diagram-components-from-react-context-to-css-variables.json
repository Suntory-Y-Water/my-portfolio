{
  "id": "ADR-0003",
  "timestamp": "2026-01-02T17:00:00+09:00",
  "title": "Migrate Diagram Components from React Context to CSS Variables for Dark Mode and JavaScript Reduction",
  "status": "accepted",
  "context": {
    "problem": "図解ページコンポーネント群がReact Context APIでテーマ管理しており、(1) すべてのコンポーネントでclient:loadが必要で不要なJavaScriptを送信、(2) カラーパレットがハードコードされブログの既存テーマと一貫性がない、(3) ダークモードに対応していない、(4) Astro 5.x Islands Architectureのベストプラクティス「デフォルトは静的」に反している",
    "constraints": [
      "Astro 5.x Islands Architecture",
      "Tailwind CSS v4",
      "ブログの既存テーマ（globals.css）との互換性",
      "静的HTML生成によるSSGの利点を最大化"
    ],
    "requirements": [
      "ダークモード自動対応",
      "ブログ全体で統一されたデザイン",
      "不要なJavaScriptの削減",
      "図解コンテンツは静的HTML（インタラクティブ性不要）"
    ]
  },
  "decision": {
    "summary": "React Context APIを削除し、ブログの既存CSS変数（globals.css）を使用した静的HTMLレンダリングに移行",
    "details": "ThemeContext、useTheme()、DEFAULT_THEMEを削除し、すべてのインラインスタイルをTailwind CSSクラスに変更。ブログのglobals.cssで定義されたCSS変数（--primary、--accent、--muted、--foreground等）を使用することで、ダークモード対応を自動化し、client:loadを削除して静的HTML生成を実現。",
    "alternatives": [
      {
        "option": "React Contextを保持し、client:loadで動的テーマ切り替え機能を提供",
        "pros": ["ユーザーが記事ごとにテーマを選択可能", "動的な色変更が可能"],
        "cons": [
          "JavaScriptバンドルサイズが増加",
          "ページロード速度が低下",
          "Astro 5.xのベストプラクティスに反する",
          "現時点で記事ごとのテーマ変更要件がない"
        ],
        "rejected": true,
        "reason": "図解はブログの一部であり、ブログのテーマに従うべきという要件から、動的テーマ変更は不要と判断。パフォーマンスと保守性を優先。"
      },
      {
        "option": "CSS Modulesやstyled-componentsを使用",
        "pros": ["コンポーネント単位でスタイル管理", "CSS-in-JSの柔軟性"],
        "cons": [
          "ブログの既存テーマ（Tailwind CSS）と統合が困難",
          "ランタイムコストが発生",
          "ダークモード対応に追加実装が必要"
        ],
        "rejected": true,
        "reason": "ブログ全体で使用しているTailwind CSSとの一貫性を保つため、CSS変数 + Tailwindの組み合わせを選択。"
      }
    ],
    "rationale": "Astro 5.x Islands Architectureのベストプラクティス「デフォルトは静的」に従い、図解コンテンツはインタラクティブ性が不要であることから、JavaScriptなしの静的HTML生成を選択。ブログの既存テーマ（globals.css）のCSS変数を活用することで、ダークモード対応が自動化され、保守性が向上する。",
    "consequences": [
      "JavaScriptバンドルサイズの削減（React Context関連のコード削除）",
      "ページロード速度の向上（静的HTML）",
      "ダークモードがCSSレベルで自動対応（.darkクラスの切り替えで動作）",
      "カラーパレットがglobals.cssで一元管理され、保守性向上",
      "動的なテーマ変更機能は実装不可（将来的に必要な場合は再設計）"
    ]
  },
  "implementation": {
    "affected_files": [
      "src/components/feature/diagram/content-common.tsx",
      "src/components/feature/diagram/hero-section.tsx",
      "src/components/feature/diagram/problem-section.tsx",
      "src/components/feature/diagram/core-message-section.tsx",
      "src/components/feature/diagram/steps-section.tsx",
      "src/components/feature/diagram/message-section.tsx",
      "src/components/feature/diagram/action-section.tsx",
      "src/components/feature/diagram/transition-section.tsx",
      "src/components/feature/diagram/dynamic-page-builder.tsx",
      "src/types/diagram.ts",
      "src/pages/blog/diagram/index.astro"
    ],
    "affected_components": [
      "DiagramPageBuilder",
      "HeroSection",
      "ProblemSection",
      "CoreMessageSection",
      "StepsSection",
      "MessageSection",
      "ActionSection",
      "TransitionSection"
    ],
    "code_patterns": [
      "React Context削除: ThemeContext、useTheme()、DEFAULT_THEMEを削除",
      "インラインスタイル削除: style={{ color: colors.navy }}をclassName='text-primary'に変更",
      "CSS変数マッピング: navy → --primary、gold → --accent、grayBg → --muted、white → --background、textMain → --foreground、textLight → --muted-foreground",
      "Tailwind CSSクラス使用: text-primary、bg-muted、border-accent等",
      "client:load削除: <DynamicPageBuilder />として静的HTMLレンダリング"
    ],
    "examples": [
      {
        "file": "src/components/feature/diagram/content-common.tsx",
        "line_start": 1,
        "line_end": 50,
        "description": "ThemeContext、useTheme()、DEFAULT_THEMEを削除し、IconとFormattedTextのみ保持"
      },
      {
        "file": "src/components/feature/diagram/hero-section.tsx",
        "line_start": 1,
        "line_end": 80,
        "description": "useTheme()を削除し、className='text-primary'、'bg-muted'等のTailwindクラスを使用"
      },
      {
        "file": "src/pages/blog/diagram/index.astro",
        "line_start": 1,
        "line_end": 20,
        "description": "client:loadを削除し、静的HTMLとしてDynamicPageBuilderをレンダリング"
      }
    ]
  },
  "metadata": {
    "tags": [
      "astro",
      "islands-architecture",
      "ssg",
      "dark-mode",
      "css-variables",
      "tailwind-css",
      "react",
      "performance",
      "diagram-components"
    ],
    "related_adrs": [],
    "supersedes": null,
    "superseded_by": null,
    "author": "Claude Sonnet 4.5",
    "reviewers": []
  },
  "search_keywords": [
    "diagram components",
    "dark mode",
    "CSS variables",
    "React Context",
    "Astro Islands",
    "static HTML",
    "JavaScript reduction",
    "Tailwind CSS",
    "globals.css",
    "theme migration",
    "SSG optimization",
    "client:load",
    "カラーパレット",
    "ダークモード対応",
    "静的生成"
  ],
  "vector_embedding": null
}
