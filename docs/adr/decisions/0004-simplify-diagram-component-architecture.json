{
  "id": "ADR-0004",
  "timestamp": "2026-01-05T08:44:00+09:00",
  "title": "Simplify Diagram Component Architecture and Remove Abstraction Layers",
  "status": "accepted",
  "context": {
    "problem": "Diagram機能の実装において、過度な抽象化と複雑な設定システムにより、コードの保守性が低下し、デザインシステムの一貫性が失われていた。具体的には、Card/Badgeコンポーネントのラッピング、カラーキーシステム、大規模なアイコン設定ファイル、Zodスキーマベースの型定義など、複数の抽象化レイヤーが存在していた。",
    "constraints": [
      "Astro 5.x SSGアーキテクチャを維持",
      "既存のダイアグラムコンテンツとの互換性を確保",
      "Tailwind CSS 4.xのテーマシステムを活用",
      "TypeScriptの型安全性を維持"
    ],
    "requirements": [
      "コードの保守性向上",
      "デザインシステムの一貫性改善",
      "不要な抽象化レイヤーの削除",
      "コア機能への集中"
    ]
  },
  "decision": {
    "summary": "過度な抽象化を排除し、Tailwindの標準的なユーティリティクラスとdiv要素による直接的な実装に移行。Zodスキーマベースの型定義から、TypeScriptの直接的な型定義へ移行し、使用していないセクションタイプを削除。",
    "details": "以下の主要な変更を実施:\n\n1. **UIコンポーネントの簡素化**: Card/Badgeコンポーネントからプレーンなdivへ置き換え、Tailwindクラスを直接適用\n2. **カラーシステムの統一**: COLORS定数とresolveColor関数を削除し、Tailwindのテーマカラー（primary, muted等）に統一\n3. **アイコンシステムの簡素化**: icon-config.ts（165行）を削除し、content-common.tsx内に12個の必要なアイコンのみを直接マッピング\n4. **型定義の直接化**: diagram-schemas.ts（197行のZodスキーマ）を削除し、diagram.tsでTypeScriptの型を直接定義\n5. **データ構造の改善**: ArticleSection[]からArticleData型（meta + content構造）へ変更、各セクションにidプロパティを追加してReactのkey問題を解決\n6. **未使用セクションの削除**: FlowChartSection、GroupedContentSection、ListStepsSection、ScoreComparisonSectionを削除\n7. **バリアント機能の削除**: CoreMessageSectionとProblemSectionのvariantプロパティを削除し、スタイルを単一化",
    "alternatives": [
      {
        "option": "既存の抽象化レイヤーを維持し、段階的にリファクタリング",
        "pros": [
          "変更の影響範囲を限定できる",
          "既存コンテンツとの完全な互換性を維持"
        ],
        "cons": [
          "技術的負債が残り続ける",
          "複雑性が解消されない",
          "保守コストが高いまま"
        ],
        "rejected": true,
        "reason": "根本的な問題解決にならず、長期的な保守性向上が見込めない"
      },
      {
        "option": "Radix UIやshadcn/uiのコンポーネントシステムを全面採用",
        "pros": [
          "アクセシビリティが向上",
          "コンポーネントの再利用性が高い",
          "標準的なパターンに準拠"
        ],
        "cons": [
          "過度な抽象化が再び発生する可能性",
          "SSGに適さない重いクライアントサイドJS",
          "カスタマイズが複雑になる"
        ],
        "rejected": true,
        "reason": "静的サイト生成の利点を損なう可能性があり、シンプルなダイアグラムページには過剰"
      },
      {
        "option": "Zodスキーマを保持してランタイムバリデーションを継続",
        "pros": [
          "ランタイムでのデータ検証が可能",
          "Content Collectionsとの統合が容易"
        ],
        "cons": [
          "型定義の重複（ZodスキーマとTypeScript型の両方）",
          "197行のスキーマファイルの保守コスト",
          "実際にはランタイムバリデーションが不要"
        ],
        "rejected": true,
        "reason": "Diagram機能では外部データソースからの入力を扱わないため、ビルド時の型チェックで十分"
      }
    ],
    "rationale": "以下の理由により、抽象化の削減と直接的な実装への移行を選択:\n\n1. **YAGNI原則の適用**: 将来使うかもしれない機能（40個以上のアイコン、複数のバリアント、未使用のセクションタイプ）は実際には使われていなかった\n2. **保守性の向上**: 抽象化レイヤーを減らすことで、コードの追跡が容易になり、変更の影響範囲が明確になる\n3. **デザインシステムの一貫性**: Tailwindのテーマカラーに統一することで、ダークモード対応やカラースキーム変更が容易になる\n4. **パフォーマンス**: 不要なコンポーネントラッピングとスタイル計算を削減し、生成されるHTMLがよりシンプルになる\n5. **型安全性の維持**: Zodスキーマを削除してもTypeScriptの型定義により、コンパイル時の型安全性は完全に維持される\n6. **コードの明確性**: `<Card>`より`<div className='...'>`の方が、実際のDOM構造とスタイリングが直接的に理解できる",
    "consequences": [
      "コード量が3,738行削減され、保守負担が大幅に軽減",
      "新しいアイコン追加時はcontent-common.tsxの1箇所のみ修正すればよい（従来は3箇所必要だった）",
      "デザイン変更時にTailwindのテーマ設定のみで全体に反映可能",
      "各セクションにidプロパティが必須となり、Reactのkey warningが解消",
      "未使用のセクションタイプが削除されたため、将来的に必要になった場合は再実装が必要（ただし、過去6ヶ月間使用実績なし）",
      "Zodによるランタイムバリデーションが失われたが、TypeScriptのコンパイル時チェックで十分",
      "ArticleSection[]からArticleData型への変更により、メタ情報とコンテンツの分離が明確になった"
    ]
  },
  "implementation": {
    "affected_files": [
      "src/types/diagram.ts",
      "src/types/diagram-schemas.ts",
      "src/components/feature/diagram/content-common.tsx",
      "src/components/feature/diagram/dynamic-page-builder.tsx",
      "src/components/feature/diagram/core-message-section.tsx",
      "src/components/feature/diagram/problem-section.tsx",
      "src/components/feature/diagram/action-section.tsx",
      "src/components/feature/diagram/steps-section.tsx",
      "src/components/feature/diagram/transition-section.tsx",
      "src/components/feature/diagram/hero-section.tsx",
      "src/components/feature/diagram/icon-config.ts",
      "src/components/feature/diagram/flow-chart-section.tsx",
      "src/components/feature/diagram/grouped-content-section.tsx",
      "src/components/feature/diagram/list-steps-section.tsx",
      "src/components/feature/diagram/score-comparison-section.tsx",
      "src/components/ui/badge.tsx",
      "src/content.config.ts",
      "src/pages/blog/diagram/[slug].astro",
      "src/styles/markdown.css"
    ],
    "affected_components": [
      "DiagramPageBuilder",
      "HeroSection",
      "ProblemSection",
      "CoreMessageSection",
      "StepsSection",
      "ActionSection",
      "TransitionSection"
    ],
    "code_patterns": [
      "Tailwindユーティリティクラスの直接適用: <div className='bg-background p-6 rounded-lg border-2 border-primary'>",
      "アイコンマッピングのインライン定義: const icons: Record<string, React.ElementType> = { alert: AlertCircle, ... }",
      "TypeScript直接型定義: export type ProblemSectionData = BaseSection & { type: 'problem'; ... }",
      "データ構造: { meta: { id, title }, content: ArticleSection[] }",
      "セクションkey生成: key={section.id} （従来: key={`${section.type}-${index}`}）"
    ],
    "examples": [
      {
        "file": "src/components/feature/diagram/problem-section.tsx",
        "line_start": 25,
        "line_end": 45,
        "description": "Card/Badgeコンポーネントから通常のdivへの置き換え例。resolveColor関数の削除と、Tailwindクラスによる直接的なスタイリング。"
      },
      {
        "file": "src/components/feature/diagram/content-common.tsx",
        "line_start": 21,
        "line_end": 36,
        "description": "icon-config.ts（165行）を削除し、12個の必要なアイコンのみをインラインでマッピング。"
      },
      {
        "file": "src/types/diagram.ts",
        "line_start": 1,
        "line_end": 124,
        "description": "Zodスキーマ依存を削除し、TypeScriptの直接型定義に移行。ArticleData型の導入。"
      },
      {
        "file": "src/components/feature/diagram/dynamic-page-builder.tsx",
        "line_start": 16,
        "line_end": 28,
        "description": "ArticleSection[]からArticleData型への変更と、section.idを使ったkey生成。"
      }
    ]
  },
  "metadata": {
    "tags": [
      "refactoring",
      "diagram-components",
      "simplification",
      "yagni",
      "maintainability",
      "tailwind-css",
      "typescript",
      "architecture",
      "technical-debt-reduction"
    ],
    "related_adrs": ["ADR-0003"],
    "supersedes": null,
    "superseded_by": null,
    "author": "sui",
    "reviewers": []
  },
  "search_keywords": [
    "diagram refactoring",
    "component simplification",
    "remove abstraction",
    "Card component removal",
    "Badge component removal",
    "Zod schema removal",
    "icon-config deletion",
    "YAGNI principle",
    "technical debt",
    "code reduction",
    "Tailwind utility classes",
    "direct styling",
    "type definition",
    "ArticleData",
    "section id",
    "maintainability improvement",
    "design system consistency",
    "color system unification",
    "variant removal"
  ],
  "vector_embedding": null
}
