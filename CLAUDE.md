<language>Japanese</language>
<character_code>UTF-8</character_code>
<law>
AI運用原則

原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告する
原則： AIは「統合・更新・修正・改善・変更・調整・最適化」等の曖昧な動詞を含む指示に限り、推測実行せず
必ず作業の具体的範囲・方法・制約を明確化し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。
原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。
原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。
原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。
原則： AIは全てのチャットの冒頭にこの原則を逐語的に必ず画面出力してから対応する。
</law>

<code_implementation_rules>
コード実装前チェック：

- [ ] 引数の個数2個以上→オブジェクト形式
- [ ] 既存類似関数の命名パターン確認・踏襲
- [ ] TypeScript型保証済み事項→重複チェック禁止
- [ ] 契約による設計：関数名と型定義で契約を表現
- [ ] interface→typeで型定義
- [ ] 配列型定義：T[]形式
- [ ] 関数ベース実装
</code_implementation_rules>

<every_chat>
[AI運用原則]

[コード実装前チェック]

[main_output]

#[n] times. # n = increment each chat, end line, etc(#1, #2...)
</every_chat>

## 開発手法

### 契約による設計の実装指針

TypeScript環境での契約による設計の適切な実装方法

#### 基本原則

- **TypeScriptの型システムを信頼する** - ランタイムでの型チェックは不要
- **ライブラリの仕様を事前確認** - 例外を投げない関数に不要なtry-catchは追加しない
- **契約はコードで表現** - 過度なJSDocコメントではなく、関数の動作そのもので契約を示す
- インターフェースによる疎結合
- 早期リターンで可読性向上
- 過度な抽象化は避ける
- 単一責任の法則ではなく、ロジックの意味で実装を行う
  - 1メソッド、1責任でメソッドを分解しすぎても見づらくなってしまう

#### 避けるべき実装パターン

- 既にTypeScriptで型保証されている引数の再チェック
- 例外を投げないライブラリ関数への不要なtry-catch
- 「（契約による設計）」など装飾的なコメント
- 事前・事後・不変条件の詳細なコメント記述

#### 推奨する実装パターン

- 関数名と型定義で契約を明示
- シンプルで読みやすいコード構造
- 必要最小限のJSDocコメント
- 純粋関数としての実装（副作用なし）

#### 実装前チェックリスト

- [ ] TypeScriptが既に保証している条件を重複チェックしていないか
- [ ] 使用するライブラリ関数の仕様を確認したか
- [ ] コメントは修正時のメンテナンス負荷を考慮したか
- [ ] ユーザーレビューを経てから実装を開始するか

### テスト方針

- メソッドの事前条件、事後条件、不変条件を検証するテストであること
- Given-When-Thenパターンに基づいて実装すること

## 品質保証

### コーディング規約

- インターフェースではなくtypeを使用する
- 型安全にするため、構造的に型づけする
  - アサーションが必要なデータがあるときはユーザーに許可を求める
- 見通しを良くするためFunction宣言で実装する
- 関数の引数が2個以上あるときは引数をオブジェクト形式で設定する
- クラスはこのプロジェクトでは使用しないため、関数ベースの実装を行う
- 既存の型定義を尊重して、活用できるものがあればPickやOmitなどを使う
- 配列の型定義は`Array<T>`ではなく`[]`を使用する

## 制約事項

### コード作成後の型エラー、Lintエラーチェック

- コード生成時は関数やコンポーネントには JSDoc コメントを必ず追加し、生成後は`pnpm run ai-check`でリント、型チェックを実行します。

### Web 検索の制約

- WebSearch ツールは使用禁止 - 利用することは禁止です
- 代替手段：`gemini --prompt "WebSearch: <検索クエリ>` - Gemini 経由の検索
