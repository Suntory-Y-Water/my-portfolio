---
title: ã€Pythonã€‘åˆã‚ã¦ã®è‡ªç„¶è¨€èªå‡¦ç†ï¼Ÿdiscord.pyã§ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå˜èªã«åå¿œã™ã‚‹botã‚’ä½œã£ã¦ã¿ãŸã€‚
slug: my-first-natural-language-processing-i
date: 2023-04-02
description: Pythonã¨discord.pyã‚’ä½¿ã£ã¦ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå˜èªã«åå¿œã™ã‚‹botã‚’ä½œæˆã€‚è‡ªç„¶è¨€èªå‡¦ç†ã¨å½¢æ…‹ç´ è§£æã®å…¥é–€ã€‚
icon: ğŸ¤–
icon_url: https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Robot/Flat/robot_flat.svg
tags:
  - Python
  - mecab
  - è‡ªç„¶è¨€èªå‡¦ç†
  - å½¢æ…‹ç´ è§£æ
  - discord.py
---
# ã¾ãˆãŒã

è‡ªç„¶è¨€èªå‡¦ç†ã€å½¢æ…‹ç´ è§£æã«ã¤ã„ã¦ç†è§£ã§ãã¦ã„ãªã„éƒ¨åˆ†ãŒå¤šã„ã§ã™ã€‚

èª¤ã£ãŸè§£é‡ˆã‚’ã—ã¦ã„ãŸã‚‰ã€ã”æŒ‡æ‘˜ãã ã•ã„ã€‚

# ç›®çš„

å‹äººåŒå£«ã§Twitterã®ã‚ˆã†ã«ä½¿ã£ã¦ã„ã‚‹discordé¯–ã§ã€Œ**ãƒã‚¬ãƒ†ã‚£ãƒ–ãªç™ºè¨€ã£ã¦ã€è‡ªåˆ†ã«ã‚‚å‘¨ã‚Šã«ã‚‚è‰¯ããªã„ã‚ˆãª**ã€ã¨ã„ã£ãŸè©±ã«ãªã£ãŸã€‚

ç§ãŒä»¥å‰ã‹ã‚‰discordã®botã¨è‡ªç„¶è¨€èªå‡¦ç†ã«èˆˆå‘³ãŒã‚ã£ãŸã®ã§ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå˜èªã«åå¿œã—æ°—ã¥ãã‚’å¾—ã¦ã‚‚ã‚‰ã†ç›®çš„ã§botã‚’ä½œæˆã—ãŸã€‚

# å®Ÿæ–½æ–¹æ³•

Pythonã§discord.pyã‚’ç”¨ã„ã¦botã‚’ä½œæˆã—ã€æ–‡ä½“ã‚’å½¢æ…‹ç´ è§£æã—ã¦ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå˜èªã‚’ç™ºè¦‹ã—ãŸã‚‰åå¿œã•ã›ã‚‹ã‚ˆã†ã«ã—ãŸã€‚

ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå˜èªã®è¦ä»¶ã¨ã—ã¦ã€æ—¥æœ¬èªè©•ä¾¡æ¥µæ€§è¾æ›¸ã‚’ç”¨ã„ã‚‹ã€‚

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

``` python:source.py
import os
import discord
import MeCab
from collections import defaultdict

# æ—¥æœ¬èªè©•ä¾¡æ¥µæ€§è¾æ›¸ã®èª­ã¿è¾¼ã¿ 
polarity_dict = defaultdict(lambda: 0)
with open('pn_ja_dic.txt', 'r', encoding='utf-8') as f:
    for line in f:
        word, _, _, polarity = line.strip().split(':')
        polarity_dict[word] = float(polarity)

# MeCabã®è¨­å®š
tagger = MeCab.Tagger()

# Bot ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
DISCORD_BOT_TOKEN = os.environ.get("MY_DISCORD_BOT_TOKEN")

# æ¥ç¶šã«å¿…è¦ãªè¨­å®š/ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
intents = discord.Intents.all()
client = discord.Client(intents=intents)

# èµ·å‹•æ™‚ã«å‹•ä½œã™ã‚‹å‡¦ç†
@client.event
async def on_ready():
    # èµ·å‹•ã—ãŸã‚‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«é€šçŸ¥ã™ã‚‹
    print("YOUR DISCORD BOT is ACTIVE now!")

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æ™‚ã«å‹•ä½œã™ã‚‹å‡¦ç†
@client.event
async def on_message(message):
    print(f"Received message: {message.content}")  # Debug message

    # Botã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–ã™ã‚‹
    if message.author == client.user:
        return

    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ„Ÿæƒ…åˆ†æã‚’è¡Œã†
    node = tagger.parseToNode(message.content)
    sentiment = 0
    while node:
        sentiment += polarity_dict[node.surface]
        node = node.next

    # ãƒã‚¬ãƒ†ã‚£ãƒ–ãªé›°å›²æ°—ã‚’æ„Ÿã˜ã‚‹å ´åˆã€è¿”ä¿¡ã‚’é€ä¿¡ã™ã‚‹
    # é–¾å€¤ã¯è¦èª¿æ•´
    if sentiment < -0.7:  
        await message.channel.send("ãƒ”ãƒ”ãƒ¼ã£ï¼ğŸ‘®ğŸ‘®ãƒã‚¬ãƒ†ã‚£ãƒ–è­¦å¯Ÿã§ã™ğŸš¨ğŸš¨ğŸš¨ğŸ™…ğŸ™…ğŸ™…ğŸ™…\nãã®ã¤ã¶ã‚„ãã¯â—â—â—ãƒã‚¬ãƒ†ã‚£ãƒ–ãªè€ƒãˆã«ãªã‚‹ã‚¾ğŸ˜¤ğŸ˜¤ğŸ˜¤ğŸ’¢ğŸ’¢ğŸ’¢")

# Bot ã®èµ·å‹•ã¨ Discord ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶š
client.run(DISCORD_BOT_TOKEN)
```

``` text:pn_ja_dic.txt
å„ªã‚Œã‚‹:ã™ãã‚Œã‚‹:å‹•è©:1
è‰¯ã„:ã‚ˆã„:å½¢å®¹è©:0.999995
å–œã¶:ã‚ˆã‚ã“ã¶:å‹•è©:0.999979
è¤’ã‚ã‚‹:ã»ã‚ã‚‹:å‹•è©:0.999979
ã‚ã§ãŸã„:ã‚ã§ãŸã„:å½¢å®¹è©:0.999645

(ä¸­ç•¥)

ãªã„:ãªã„:åŠ©å‹•è©:-0.999997
é…·ã„:ã²ã©ã„:å½¢å®¹è©:-0.999997
ç—…æ°—:ã³ã‚‡ã†ã:åè©:-0.999998
æ­»ã¬:ã—ã¬:å‹•è©:-0.999999
æ‚ªã„:ã‚ã‚‹ã„:å½¢å®¹è©:-1
```

# å®Ÿéš›ã®æŒ™å‹•ã¨èª²é¡Œ

![ãƒã‚¬ã¡ã‚ƒã‚“.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/837411/e633dc31-2147-4557-ad5a-1a430bfc3da4.png)


ç¾åœ¨ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã ã¨ã€æ¥µæ€§å€¤ã‚’åŠ ç®—ã—ã¦ã„ã‚‹ãŸã‚å„å“è©ã®æ¥µæ€§å€¤ã‚’è¨ˆç®—ã—ãŸå¾Œã«ãƒã‚¬ãƒã‚¸åˆ¤å®šã‚’ã—ã¦ã„ã‚‹ã€‚

ãã®ãŸã‚**ä»Šæ—¥ã¯èª•ç”Ÿæ—¥ã§ã™ã€‚** ã¯åå¿œã—ãªã„ãŒã€**ä»Šæ—¥ã¯æ°´ç€¬ã„ã®ã‚Šã•ã‚“ã®èª•ç”Ÿæ—¥ã§ã™ã€‚** ã«ãªã‚‹ã¨åå¿œã™ã‚‹ã€‚

å„å“è©ã®æ¥µæ€§å€¤ã‚’ç®—å‡ºã™ã‚‹ã¨ã€**æ—¥**ã‚„**ã•**ã§æ¥µæ€§å€¤ãŒãƒã‚¤ãƒŠã‚¹ã«å‘ã‹ã†ã“ã¨ãŒåˆ†ã‹ã£ãŸã€‚

``` :ä»Šæ—¥ã¯èª•ç”Ÿæ—¥ã§ã™ã€‚
ä»Šæ—¥: 0.172375
Sentiment:0.172375
ã¯: 0
Sentiment:0.172375
èª•ç”Ÿ: 0.396127
Sentiment:0.5685020000000001
æ—¥: -0.903573
Sentiment:-0.3350709999999999
ã§ã™: 0
Sentiment:-0.3350709999999999
ã€‚: 0
Sentiment:-0.3350709999999999
: 0
Sentiment:-0.3350709999999999
Total Sentiment:-0.3350709999999999
```

``` :ä»Šæ—¥ã¯æ°´ç€¬ã„ã®ã‚Šã•ã‚“ã®èª•ç”Ÿæ—¥ã§ã™ã€‚
ä»Šæ—¥: 0.172375
Sentiment:0.172375
ã¯: 0
Sentiment:0.172375
æ°´: 0
Sentiment:0.172375
ç€¬: -0.273752
Sentiment:-0.101377
ã„ã®ã‚Š: 0
Sentiment:-0.101377
ã•: -0.93584
Sentiment:-1.037217
ã‚“: 0
Sentiment:-1.037217
ã®: 0
Sentiment:-1.037217
èª•ç”Ÿ: 0.396127
Sentiment:-0.64109
æ—¥: -0.903573
Sentiment:-1.544663
ã§ã™: 0
Sentiment:-1.544663
ã€‚: 0
Sentiment:-1.544663
: 0
Sentiment:-1.544663
Total Sentiment:-1.544663
Received message: ãƒ”ãƒ”ãƒ¼ã£ï¼ğŸ‘®ğŸ‘®ãƒã‚¬ãƒ†ã‚£ãƒ–è­¦å¯Ÿã§ã™ğŸš¨ğŸš¨ğŸš¨ğŸ™…ğŸ™…ğŸ™…ğŸ™…
ãã®ã¤ã¶ã‚„ãã¯â—â—â—ãƒã‚¬ãƒ†ã‚£ãƒ–ãªè€ƒãˆã«ãªã‚‹ã‚¾ğŸ˜¤ğŸ˜¤ğŸ˜¤ğŸ’¢ğŸ’¢ğŸ’¢
```

# ä»Šå¾Œã®æ”¹å–„

- æ¥µæ€§å€¤ã‚’åˆ¤å®šã™ã‚‹å“è©ã‚’é™å®šã™ã‚‹
- ã©ã†ã«ã‹ã“ã†ã«ã‹ã—ã¦ã€æ–‡ä½“ã‹ã‚‰ãƒã‚¬ãƒ†ã‚£ãƒ–è¦ç´ ã‚’æŠœãå‡ºã—ã¦åæ˜ ã•ã›ã‚‹

[ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°](https://nanjamonja.net/archives/766)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã¨ãŠã‚Šã§ã™ãŒã€æ¥µæ€§è¾æ›¸ã«ãªã„å˜èªã¯åˆ¤å®šã§ããªã„ã—ã€æ–‡è„ˆã«ã‚ˆã£ã¦ç•°ãªã‚‹å˜èªã¯èª¤ã£ã¦åˆ¤å®šã•ã‚Œã¾ã™ã€‚

æ—¥æœ¬èªã£ã¦é›£ã—ã„â€¦

# ãã®ä»–

github â†’ https://github.com/Suntory-Y-Water/NegativeCommentsCheck

